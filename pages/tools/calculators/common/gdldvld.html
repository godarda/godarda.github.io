---
permalink: calculators/common/gdldvld
title: Expression Calculator
description: "Evaluate mathematical expressions instantly. Supports basic arithmetic, parentheses, and common functions."
---

{% capture tools_inputs %}
<div class="mb-0">
    <textarea id="inputText" class="form-control" placeholder="e.g., (3 + 4) * 2 - 9 // 2 + 2**3" aria-label="Expression to evaluate" rows="3"></textarea>
</div>
{% endcapture %}

{% capture help_content %}
<p><strong>How to use:</strong></p>
<ul>
    <li><strong>Input:</strong> Type a mathematical expression (e.g., <code>2 + 2</code>).</li>
    <li><strong>Operators:</strong> Supports <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>//</code> (floor division), <code>%</code>, <code>**</code> (power).</li>
    <li><strong>Trim:</strong> Use the Trim button or <kbd>Ctrl</kbd>+<kbd>Enter</kbd> to remove whitespace.</li>
</ul>
{% endcapture %}

{% include tools.html %}

<script>
(function () {
    // Custom floor division to mimic Python's behavior (e.g., 9.0 // 2 = 4.0)
    function pyFloorDiv(a, b) {
        const numA = parseFloat(a);
        const numB = parseFloat(b);
        const result = Math.floor(numA / numB);
        if (String(a).includes('.') || String(b).includes('.')) {
            return result.toFixed(1);
        }
        return result;
    }

    function safeEval(expression) {
        const sanitized = expression.replace(/[^-()\d/*+.\% xX^]/g, '');
        if (sanitized !== expression) {
            throw new Error('Invalid characters in expression.');
        }
        const invalidRepeatRegex = /\/{3,}|(?<!\*)\*{3,}|[+%xX]{2,}/;
        if (invalidRepeatRegex.test(sanitized)) {
            throw new Error('Invalid expression: repeated operators.');
        }
        let jsExpression = sanitized.replace(/(-?\(.+?\)|-?[\d.]+)\s*\/\/\s*(-?\(.+?\)|-?[\d.]+)/g, "pyFloorDiv('$1', '$2')");
        jsExpression = jsExpression.replace(/\^/g, '**');
        jsExpression = jsExpression.replace(/[xX]/g, '*');
        const result = new Function('pyFloorDiv', 'return ' + jsExpression)(pyFloorDiv);
        return Number(result.toFixed(12));
    }

    const stats = {
        result: { name: 'Result', default: true }
    };

    setupTool({
        inputs: ['inputText'],
        stats: stats,
        calculate: (values) => {
            const text = values.inputText.trim();
            const resEl = stats.result.valElement;

            if (resEl) resEl.classList.remove('text-danger');

            if (text === '') return { result: '-' };

            try {
                const res = safeEval(text);
                return { result: res };
            } catch (e) {
                if (resEl) resEl.classList.add('text-danger');
                return { result: 'Invalid expression' };
            }
        }
    });

    // Inject Trim Button and Logic
    const btnClear = document.getElementById('btnClear');
    if (btnClear) {
        const col = document.createElement('div');
        col.className = 'col-auto';
        col.innerHTML = '<button id="btnTrim" class="btn btn-sm btn-outline-secondary">Trim</button>';
        btnClear.parentNode.after(col);

        const btnTrim = document.getElementById('btnTrim');
        const input = document.getElementById('inputText');

        const doTrim = () => {
            input.value = input.value.trim();
            input.dispatchEvent(new Event('input'));
        };

        btnTrim.addEventListener('click', doTrim);
        input.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                doTrim();
            }
        });
    }
})();
</script>
