{%- if path[1] == "about" and path[2] == nil -%}{%- assign about_section = "about_home_true" -%}
{%- elsif path[1] == "about" and path[2] != nil -%}{%- assign about_section = "about_home_false" -%}{%- endif -%}
<div id="app" class="container {{ about_section }}" style="display: none;">
    <div class="board">
        <div class="boardtitle"><i class="bi bi-link"></i> Social Handles</div>
        <a class="card" href="{{ site.data.url.linkedin }}">LinkedIn</a>
        <a class="card" href="{{ site.data.url.github }}">GitHub</a>
        <a class="card" href="{{ site.data.url.discord }}">Discord</a>
    </div>
    <div class="board">
        <div class="boardtitle"><i class="bi bi-gear-wide-connected"></i> App Settings</div>
        <a id="version" class="card disabled"></a>
        <a id="cache" class="card" href="clear:">Clear: Cache and History</a>
        <a id="app-theme-switcher" class="card" style="cursor: pointer;">Theme: System Default</a>
    </div>
</div>

{%- if path[1] == nil or path[1] == "testapp" -%}{%- assign flag = "block_webfooter" -%}{%- endif -%}
<div id="backtotop" class="text-center" style="display: none; padding-top: 15px; margin-bottom: 15px;"><a class="back-to-top" style="cursor: pointer;" title="Back to top"><i class="svgicon bi bi-arrow-bar-up"></i></a>
</div>

<footer class="isWebsite {{ flag }}" id="isWebsite" style="display: none; padding-top: 15px;">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-6 col-md-3" style="padding-bottom: 50px;">
                    <h6>What's new</h6>
                    <a href="python/"><div><i class="bi bi-rocket"></i> Python</div></a>
                    <a href="ds/"><div><i class="bi bi-pie-chart"></i> Data Science</div></a>
                    <a href="mongodb/"><div><i class="bi bi-database"></i> MongoDB</div></a>
                </div>
                <div class="col-6 col-md-3" style="padding-bottom: 50px;">
                    <h6>GoDarda</h6>
                    <a href="about"><div><i class="bi bi-question-circle"></i> About Us</div></a>
                    <a href="about/faqs"><div><i class="bi bi-star"></i> FAQs</div></a>
                    <a href="shubhamrdarda"><div><i class="bi bi-person-square"></i> Meet Architect</div></a>
                </div>
                <div class="col-6 col-md-3" style="padding-bottom: 50px;">
                    <h6>Useful Links</h6>
                    <a href="about/terms"><div><i class="bi bi-card-text"></i> Terms</div></a>
                    <a href="about/privacy"><div><i class="bi bi-shield-check"></i> Privacy</div></a>
                    <a href="about/disclaimer"><div><i class="bi bi-exclamation-triangle"></i> Disclaimer</div></a>
                </div>
                <div class="col-6 col-md-3" style="padding-bottom: 50px;">
                    <h6>Social Handles</h6>
                    <a href="{{ site.data.url.linkedin }}" target="_blank" rel="noopener noreferrer"><div><i class="bi bi-linkedin"></i> LinkedIn</div></a>
                    <a href="{{ site.data.url.github }}" target="_blank" rel="noopener noreferrer"><div><i class="bi bi-github"></i> GitHub</div></a>
                    <a href="{{ site.data.url.discord }}"><div><i class="bi bi-discord"></i> Discord</div></a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="appmodal" data-bs-backdrop="static" data-bs-keyboard="false"
        aria-labelledby="appmodalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="appmodalLabel"><i class="bi bi-android2"></i> GoDarda Android App</h5>
                </div>
                <div class="modal-body">Dear User, <br>We are grateful for your interest in the GoDarda Android app. We
                    intend to soon make it available on the Google Play Store. Currently, you need to install apk
                    manually. Would you like to get the app?<br>Minimum Requirement(s): Android 11</div>
                <div class="modal-footer justify-content-center">
                    <a style="cursor: pointer; border: 1px solid #e63636;" class="btn" data-bs-dismiss="modal"><i class="bi bi-cloud-slash"></i> No</a>
                    <a href="{{ site.data.url.android_app }}" style="border: 1px solid #00b050;" class="btn" onclick="$('#appmodal').modal('hide');"><i class="bi bi-cloud-arrow-down"></i> Yes</a>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-center copyright-footer">
        <small>&copy; {% assign current_year = 'now' | date: '%Y' %}{{ current_year }} {{ site.title }}. All Rights Reserved.</small>
    </div>
</footer>

<footer class="isWebView" id="isWebView" style="display: none;">
{% if path[1] == nil %}
    {% assign f_home="wvnav-item-active" %}
{% elsif path[1] == "tools" or path[1] == "calculators" or path[1] == "converters" %}
    {% assign f_tools="wvnav-item-active" %}
{% elsif path[1] == "about" or path[1] == "shubhamrdarda" %}
    {% assign f_about="wvnav-item-active" %}
{% else %}
    {% assign f_learn="wvnav-item-active" %}
{% endif %}
<div class="d-flex justify-content-between wvnav">
    <a class="wvnav-item {{ f_home }}" href="{{ site.url }}"><i class="wvsvg {{ f_home }}- bi {% if f_home == "wvnav-item-active" %}bi-house-heart-fill{% else %}bi-house-heart{% endif %}"></i><div class="text-center">Home</div></a>
    <a class="wvnav-item {{ f_learn }}" href="{{ site.url }}/learn"><i class="wvsvg {{ f_learn }}-{{ path[1] }} bi {% if f_learn == "wvnav-item-active" %}bi-lightbulb-fill{% else %}bi-lightbulb{% endif %}"></i><div class="text-center">Learn</div></a>
    <a id="share-button" class="wvnav-item" href="share:{{ site.url }}{{ page.url }}"><i class="wvsvg bi bi-share"></i><div class="text-center">Share</div></a>
    <a class="wvnav-item {{ f_tools }}" href="{{ site.url }}/tools"><i class="wvsvg {{ f_tools }}-{{ path[1] }} bi {% if f_tools == "wvnav-item-active" %}bi-gear-fill{% else %}bi-gear{% endif %}"></i><div class="text-center">Tools</div></a>
    <a class="wvnav-item {{ f_about }}" href="{{ site.url }}/about"><i class="wvsvg {{ f_about }}-about bi {% if f_about == "wvnav-item-active" %}bi-info-circle-fill{% else %}bi-info-circle{% endif %}"></i><div class="text-center">About</div></a>
</div>
</footer>

<script type="text/javascript">
/**
 * Fetches the latest version tag from GitHub commits and updates the UI.
 * The version tag is expected to be in the format vXX.XX.
 */
async function showVersion() {
    const versionElement = document.getElementById("version");
    if (!versionElement) return;

    try {
        const response = await fetch("https://api.github.com/repos/godarda/godarda.github.io/commits");
        const commits = await response.json();
        const regex = /^v\d{2}\.\d{1,2}$/;
        let versionCommit = null;

        for (const commit of commits) {
            const firstLine = commit.commit.message.split("\n")[0].trim();
            if (regex.test(firstLine)) {
                versionCommit = firstLine;
                break;
            }
        }
        versionElement.textContent = versionCommit ? `App Version: ${versionCommit}` : "App Version: (not tagged)";
    } catch (error) {
        console.error("Error fetching commits:", error);
        versionElement.textContent = "App Version: (error)";
    }
}

/**
 * Configures the UI for the native Android app environment.
 * This view features a bottom navigation bar and disables certain web functionalities.
 */
function setupAppView() {
    document.body.classList.add('is-webview');
    document.getElementById("isWebView").style.display = "block";
    document.getElementById("backtotop").style.marginBottom = "100px";

    // Disable text selection and context menu for a more native feel
    document.onselectstart = (e) => e.preventDefault();
    $('body').on('contextmenu', () => false);

    const aboutSection = document.getElementById("app");
    if (aboutSection && aboutSection.classList.contains("about_home_true")) {
        aboutSection.style.display = "block";
    }

    const shareButton = document.getElementById("share-button");
    if (shareButton) {
        let isClickDisabled = false;

        // A single click will proceed, but rapid clicks (like a double-click) will be blocked.
        shareButton.addEventListener('click', (event) => {
            if (isClickDisabled) {
                event.preventDefault(); // Block the second click of a double-click
            } else {
                isClickDisabled = true;
                setTimeout(() => { isClickDisabled = false; }, 400); // Cooldown period
            }
        });

        // Prevent the default double-click action (e.g., text selection) on the share button.
        shareButton.addEventListener('dblclick', (event) => {
            event.preventDefault();
        });
    }

    // Activate share window on double-touch anywhere within the webview.
    document.body.addEventListener('dblclick', (event) => {
        // Prevent triggering share on interactive elements like links or buttons.
        if (event.target.closest('a, button')) {
            return;
        }
        window.location.href = "share:{{ site.url }}{{ page.url }}";
    });
}

/**
 * Configures the UI for the standard web browser environment.
 * This view shows the standard website footer.
 */
function setupWebAppView() {
    const rsidebar = document.getElementById("rsidebar");
    if (rsidebar) {
        rsidebar.removeAttribute("style");
    }

    const webfooter = document.getElementById("isWebsite");
    if (webfooter && !webfooter.classList.contains("block_webfooter")) {
        webfooter.style.display = "block";
    }
}

/**
 * Initializes the view based on the user agent, distinguishing between
 * the native app and a standard web browser. Also sets up UI event handlers.
 */
function initializeView() {
    // The user agent for the native app contains "GoDarda" or is a WebView
    if (window.isWebview || (window.userAgent && window.userAgent.includes("GoDarda"))) {
        setupAppView();
    } else {
        setupWebAppView();
    }

    // Setup for the 'Clear Cache' button
    $("#cache").click(function () {
        $(this).html("Cleared: Cache and History");
        $(this).css("color", "#00b050");
    });
}

// Fetch version information as soon as the script runs.
showVersion();

// Initialize the main view once the DOM is fully loaded.
window.addEventListener('DOMContentLoaded', initializeView);
</script>