{%- assign path = page.url | split: '/' -%}
<style>
    #suggestion-light.light-on {
        color: yellow;
    }
</style>
<script>window.gd_path1 = '{{ path[1] | default: "search" }}';</script>
<script>window.gd_search_url = '{{ "/search.json" | relative_url }}';</script>
<script src="{{ site.search_js | relative_url }}"></script>
<div><center>
    <div class="col-xs-12 col-sm-11 col-md-9 col-lg-7 col-xl-6 col-xxl-6" style="margin-bottom: 25px;">
        {%- if path[1] == nil -%}
            <h2 style="padding-top: 150px;" id="fc-{{ path[1] }}">GoDarda</h2>
            <h6 style="padding-top: 5px; padding-bottom: 10px;">{{ site.tagline }}</h6>
        {%- endif -%}

        <div id="GDS_input-{{ path[1] | default: 'search' }}" class="input-group input-group-lg">
        <input id="GDSInput" class="form-control" type="text" tabindex="1" placeholder="{{ page.title }} (type to get the results)" onkeypress="display_results();" onkeyup="display_results();" onload="clear_input();"><div id="search_icon" class="input-group-append" style="display: inline-block; padding: 10px 15px 0px 7px; font-size: 20px;"><i class="bi bi-search"></i></div><div id="close_icon" class="input-group-append" onclick="clear_input();" style="display: none; padding: 5px; font-size: 25px;"><i class="bi bi-x"></i></div>
        </div>
        <div id="suggestions-container" style="margin-top: 10px; text-align: left; display: none;">
            <span class="text-muted" style="margin-right: 5px;"><i id="suggestion-light" class="bi bi-lightbulb"></i> Suggestions:</span>
            <span id="search-suggestions"></span>
        </div>
        <div id="matchCount" class="text-muted small" style="margin-top:8px; display:none; text-align:left"></div>
    </div>

    <div id="{{ path[1] | default: 'search' }}" class="col-xs-12 col-sm-12 col-md-10 col-lg-8 col-xl-7 col-xxl-7" style="text-align: left; margin-bottom: 30px;"></div>
</center></div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const currentCategory = window.gd_path1;

    const learnSuggestions = [
        'C', 'C++', 'Java', 'Python', 'R', 'Julia', 'Octave', 'C#', 'F#',
        'Rust', 'LISP', 'Linux', 'MySQL', 'MongoDB', 'Selenium', 'Algorithm', 'Assembly', 'VBScript',
        'Ranorex', 'OpenGL', 'AWT', 'Function', 'Method', 'Class', 'Inheritance',
        'Polymorphism', 'Encapsulation', 'Abstraction', 'Array', 'Bash', 'CLI', 'Exception', 'Database',
        'Stack', 'Queue', 'Tree', 'Graph', 'Sorting', 'Searching', 'Recursion', 'XPath', 'WebDriver', 'TestNG',
        'String', 'DataFrame', 'NumPy', 'Pandas', 'Matplotlib', 'List', 'Set', 'Tuple', 'Dictionary',
        'Expression', 'Log', 'Thread', 'Matrix', 'Math', 'CRUD'
    ];

    const toolsSuggestions = [
        'Calculator', 'Converter', 'Data', 'Length', 'Time', 'Currency', 'Physics', 'Hash', 'Area', 'Volume',
        'Speed', 'Temperature', 'Pressure', 'Power', 'Energy'
    ];

    function displaySuggestions(suggestions) {
        for (let i = suggestions.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [suggestions[i], suggestions[j]] = [suggestions[j], suggestions[i]];
        }

        const suggestionsParentContainer = document.getElementById('suggestions-container');
        const suggestionsContainer = document.getElementById('search-suggestions');
        if (suggestionsContainer && suggestionsParentContainer) {
            suggestionsContainer.innerHTML = ''; // Clear previous suggestions
            const selectedSuggestions = suggestions.slice(0, 3);
            selectedSuggestions.forEach(suggestion => {
                const link = document.createElement('a');
                link.className = 'btn btn-sm btn-outline-secondary rounded-pill';
                link.href = 'javascript:void(0);';
                link.onclick = () => {
                    const input = document.getElementById('GDSInput');
                    input.value = suggestion;
                    input.focus();
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                };
                link.style.margin = '2px';
                link.style.fontSize = '12px';
                link.textContent = suggestion;
                suggestionsContainer.appendChild(link);
            });
            suggestionsParentContainer.style.display = 'block';
        }
    }

    if (currentCategory === 'search' || currentCategory === 'learn') {
        displaySuggestions(learnSuggestions);
    } else if (currentCategory === 'tools') {
        displaySuggestions(toolsSuggestions);
    } else {
        fetch('{{ "/search.json" | relative_url }}')
            .then(response => response.json())
            .then(data => {
                const keywords = new Set();
                let itemsToProcess = data.items;

                if (currentCategory) {
                    const categoryItems = data.items.filter(item => item.category === currentCategory);
                    if (categoryItems.length > 0) {
                        itemsToProcess = categoryItems;
                    }
                }

                itemsToProcess.forEach(item => {
                    const words = item.title.match(/[a-zA-Z0-9+.#-]+/g) || [];
                    words.forEach(word => {
                        const firstChar = word.charAt(0);
                        if (word && isNaN(word) && firstChar >= 'A' && firstChar <= 'Z') {
                            keywords.add(word);
                        }
                    });
                    if (item.category) {
                        const cat = item.category.charAt(0).toUpperCase() + item.category.slice(1);
                        keywords.add(cat);
                    }
                });

                const dynamicSuggestions = Array.from(keywords);
                displaySuggestions(dynamicSuggestions);
            })
            .catch(error => console.error('Error fetching or processing search.json for suggestions:', error));
    }
});
</script>