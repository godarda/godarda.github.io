{%- if path[1] == "about" and path[2] == nil -%}{%- assign about_section = "about_home_true" -%}
{%- elsif path[1] == "about" and path[2] != nil -%}{%- assign about_section = "about_home_false" -%}{%- endif -%}
<div id="app" class="container {{ about_section }}" style="display: none;">
    <div class="board">
        <div class="boardtitle"><i class="bi bi-info-circle"></i> About</div>
        <a class="card" href="about/faqs">Frequently Asked Questions</a>
        <a class="card" href="about/contribute">Contribution Guide</a>
        <a class="card" href="about/terms">Terms of Use</a>
        <a class="card" href="about/privacy">Privacy Policy</a>
        <a class="card" href="about/disclaimer">Disclaimer</a>
    </div>
    <div class="board">
        <div class="boardtitle"><i class="bi bi-link"></i> Social Handles</div>
        <a class="card" href="{{ site.data.url.linkedin }}">LinkedIn</a>
        <a class="card" href="{{ site.data.url.github }}">GitHub</a>
        <a class="card" href="{{ site.data.url.discord }}">Discord</a>
    </div>
    <div class="board">
        <div class="boardtitle"><i class="bi bi-gear-wide-connected"></i> App Settings</div>
        <a id="version" class="card disabled"></a>
        <a id="cache" class="card" href="clear:">Clear: Cache and History</a>
        <a id="app-theme-switcher" class="card" style="cursor: pointer;">Theme: System Default</a>
    </div>
</div>

<footer class="isWebView" id="isWebView" style="display: none;">
{% if path[1] == nil %}
    {% assign f_home="wvnav-item-active" %}
{% elsif path[1] == "tools" or path[1] == "calculators" or path[1] == "converters" %}
    {% assign f_tools="wvnav-item-active" %}
{% elsif path[1] == "about" or path[1] == "shubhamrdarda" %}
    {% assign f_about="wvnav-item-active" %}
{% else %}
    {% assign f_learn="wvnav-item-active" %}
{% endif %}
<div class="d-flex justify-content-between wvnav">
    <a class="wvnav-item {{ f_home }}" href="{{ site.url }}"><i class="wvsvg {{ f_home }}- bi {% if f_home == "wvnav-item-active" %}bi-house-heart-fill{% else %}bi-house-heart{% endif %}"></i><div class="text-center">Home</div></a>
    <a class="wvnav-item {{ f_learn }}" href="{{ site.url }}/learn"><i class="wvsvg {{ f_learn }}-{{ path[1] }} bi {% if f_learn == "wvnav-item-active" %}bi-lightbulb-fill{% else %}bi-lightbulb{% endif %}"></i><div class="text-center">Learn</div></a>
    <a id="share-button" class="wvnav-item" href="share:{{ site.url }}{{ page.url }}"><i class="wvsvg bi bi-share"></i><div class="text-center">Share</div></a>
    <a class="wvnav-item {{ f_tools }}" href="{{ site.url }}/tools"><i class="wvsvg {{ f_tools }}-{{ path[1] }} bi {% if f_tools == "wvnav-item-active" %}bi-gear-fill{% else %}bi-gear{% endif %}"></i><div class="text-center">Tools</div></a>
    <a class="wvnav-item {{ f_about }}" href="{{ site.url }}/about"><i class="wvsvg {{ f_about }}-about bi {% if f_about == "wvnav-item-active" %}bi-info-circle-fill{% else %}bi-info-circle{% endif %}"></i><div class="text-center">About</div></a>
</div>
</footer>

<script>
const GD_PATH_1 = "{{ path[1] | default: '' }}";
const GD_PATH_2 = "{{ path[2] | default: '' }}";
const GD_SITE_URL = "{{ site.url }}";
const GD_PAGE_URL = "{{ page.url }}";

async function showVersion() {
    const versionElement = document.getElementById("version");
    if (!versionElement) return;

    try {
        const response = await fetch(`https://api.github.com/repos/godarda/godarda.github.io/commits?t=${new Date().getTime()}`, { cache: "no-store" });
        const commits = await response.json();
        const regex = /^v\d{2}\.\d{1,2}/;
        let versionCommit = null;

        for (const commit of commits) {
            const firstLine = commit.commit.message.split("\n")[0].trim();
            const match = firstLine.match(regex);
            if (match) {
                versionCommit = match[0];
                break;
            }
        }
        versionElement.textContent = versionCommit ? `App Version: ${versionCommit}` : "App Version: (not tagged)";
    } catch (error) {
        console.error("Error fetching commits:", error);
        versionElement.textContent = "App Version: (error)";
    }
}

function setupAppView() {
    document.body.classList.add('is-webview');
    document.getElementById("isWebView").style.display = "block";
    document.getElementById("backtotop").style.marginBottom = "100px";

    document.onselectstart = (e) => e.preventDefault();
    $('body').on('contextmenu', () => false);

    const aboutSection = document.getElementById("app");
    if (aboutSection && aboutSection.classList.contains("about_home_true")) {
        aboutSection.style.display = "block";
        document.getElementById("navbar-brand").style.marginLeft = "0px";
        document.getElementById("lsidebar").style.display = "none";
        document.getElementById("leftsidebar").style.display = "none";
    } else if (aboutSection && aboutSection.classList.contains("about_home_false")) {
        document.getElementById("navbar-brand").style.marginLeft = "0px";
        document.getElementById("lsidebar").style.display = "none";
    }

    const shareButton = document.getElementById("share-button");
    if (shareButton) {
        let isClickDisabled = false;
        shareButton.addEventListener('click', (event) => {
            if (isClickDisabled) { event.preventDefault(); } 
            else { isClickDisabled = true; setTimeout(() => { isClickDisabled = false; }, 400); }
        });
        shareButton.addEventListener('dblclick', (event) => { event.preventDefault(); });
    }

    document.documentElement.addEventListener('dblclick', (event) => {
        if (event.target.closest('a, button, .navbar, .wvnav')) { return; }
        window.location.href = "share:{{ site.url }}{{ page.url }}";
    });

    $("#cache").click(function () {
        $(this).html("Cleared: Cache and History");
        $(this).css("color", "#00b050");
    });

    showVersion();
}

function setupSwipeNavigation() {
    const footer = document.getElementById("isWebView");
    if (!footer) return;
 
    let touchStartX = 0;
    let touchEndX = 0;
    const minSwipeDistance = 50;
    
    const tabs = [
        GD_SITE_URL,
        `${GD_SITE_URL}/learn`,
        `${GD_SITE_URL}/tools`,
        `${GD_SITE_URL}/about`
    ];
    
    let currentIndex = 0;
    if (GD_PATH_1 === '') {
        currentIndex = 0;
    } else if (GD_PATH_1 === 'learn') {
        currentIndex = 1;
    } else if (GD_PATH_1 === 'tools') {
        currentIndex = 2;
    } else if (['about', 'shubhamrdarda'].includes(GD_PATH_1)) {
        currentIndex = 3;
    } else {
        currentIndex = 1;
    }
    
    let virtualIndex = currentIndex;
    footer.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
    footer.addEventListener('touchend', e => {
        // Stop event from bubbling up to the document, preventing conflict with global swipe handlers.
        e.stopPropagation();

        touchEndX = e.changedTouches[0].screenX;
        const distance = touchEndX - touchStartX;
        const numTabs = tabs.length;
        if (Math.abs(distance) < minSwipeDistance) return;

        if (distance < 0) { // Swipe left (R to L) -> go next
            virtualIndex = (virtualIndex + 1) % numTabs;
        } else if (distance > 0) { // Swipe right (L to R) -> go previous
            virtualIndex = (virtualIndex - 1 + numTabs) % numTabs;
        }
        window.location.href = tabs[virtualIndex];
    }, {passive: true});
}

window.addEventListener('DOMContentLoaded', () => { 
    if (window.isGoDardaApp) { 
        setupAppView(); 
        if (GD_PATH_2 === '') { setupSwipeNavigation(); }
    } 
});
</script>